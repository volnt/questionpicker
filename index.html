<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Random Question Picker</title>
  <style>
    :root{
      --bg: #0f172a;       /* slate-900 */
      --panel: #111827;    /* gray-900 */
      --muted: #94a3b8;    /* slate-400 */
      --text: #e5e7eb;     /* gray-200 */
      --accent: #22d3ee;   /* cyan-400 */
      --accent-2: #a78bfa; /* violet-400 */
      --ok: #34d399;       /* emerald-400 */
      --warn: #fb7185;     /* rose-400 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% -10%, rgba(34,211,238,.15), transparent 50%),
                  radial-gradient(1000px 700px at 110% 10%, rgba(167,139,250,.12), transparent 50%),
                  var(--bg);
      color: var(--text);
    }
    a { color: var(--accent) }
    .container { max-width: 920px; margin: 0 auto; padding: 24px; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px; padding: 22px; box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    h1 { font-size: clamp(28px, 4vw, 40px); margin: 8px 0 6px; letter-spacing: .3px }
    h2 { font-size: clamp(20px, 3vw, 26px); margin: 14px 0 8px }
    p { color: var(--muted); line-height: 1.6 }
    .grid { display: grid; gap: 16px }
    @media(min-width: 900px){ .grid-2 { grid-template-columns: 1.1fr .9fr } }

    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    textarea, input, button { font-family: inherit }
    textarea {
      width: 100%; min-height: 220px; resize: vertical; border-radius: 14px;
      background: #0b1220; color: var(--text); border: 1px solid rgba(255,255,255,.12);
      padding: 14px; line-height: 1.5;
    }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center }
    .btn {
      border: 0; cursor: pointer; padding: 12px 16px; border-radius: 12px; font-weight: 600;
      background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #001018;
      transition: transform .06s ease, filter .2s ease; box-shadow: 0 8px 25px rgba(34,211,238,.2);
    }
    .btn.secondary { background: #0b1220; color: var(--text); border: 1px solid rgba(255,255,255,.12) }
    .btn:active { transform: translateY(1px) }

    .hidden { display: none }

    /* Question card animations */
    .stage { display: grid; place-items: center; min-height: 52vh }
    .question-card {
      max-width: 760px; text-align: center; padding: 26px 26px; border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04);
      backdrop-filter: blur(6px); box-shadow: var(--shadow);
      font-size: clamp(20px, 3.2vw, 28px);
      transform: scale(.98); opacity: 0; animation: pop .45s ease forwards;
    }
    @keyframes pop { from { transform: scale(.92); opacity: 0 } to { transform: scale(1); opacity: 1 } }
    .subtle { color: var(--muted); font-size: 14px; margin-top: 8px }

    .pill { display: inline-flex; gap: 8px; align-items: center; padding: 6px 10px; border-radius: 999px; font-size: 12px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.03) }

    .footer { margin-top: 28px; color: var(--muted); font-size: 13px }
    .small { font-size: 12px }
    .kbd { border: 1px solid rgba(255,255,255,.2); border-bottom-width: 3px; padding: 2px 6px; border-radius: 6px; background: rgba(255,255,255,.06); font-family: ui-monospace, SFMono-Regular, Menlo, monospace }
  </style>
</head>
<body>
  <div class="container">
    <!-- SETUP VIEW -->
    <section id="setupView" class="grid grid-2">
      <div class="card">
        <h1>Random Question Picker</h1>
        <p>Paste a list of questions, then start the game. During the game you can draw a <em>new random question</em> each time without repeats until the list is exhausted.</p>
        <h2>1) Prompt an LLM to create a list</h2>
        <p>Send this prompt to your LLM to generate questions on any topic. The model should respond in the <strong>standard JSON format</strong> below.</p>
        <pre class="mono card" style="white-space:pre-wrap; padding:14px; overflow:auto"><code>Generate a list of conversation questions about &lt;YOUR_TOPIC&gt; tailored to &lt;YOUR_CONTEXT&gt;.
Return ONLY valid JSON with this exact shape (no extra commentary):
{
  "title": "&lt;short title&gt;",
  "questions": [
    { "id": 1, "text": "..." },
    { "id": 2, "text": "..." }
  ]
}
Rules:
- Provide 10–40 items.
- Each object MUST include numeric "id" and string "text" fields.
- Do not include markdown, backticks, or trailing commas.</code></pre>

        <h2>2) Paste your list below</h2>
        <p>You can paste either <strong>the JSON above</strong> or simply <strong>one question per line</strong>. Then click <em>Load & Start</em>.</p>
        <textarea id="inputArea" placeholder='Example JSON:\n{\n  "title": "Tea & Candles – 20 Questions",\n  "questions": [\n    { "id": 1, "text": "What made you smile this week?" },\n    { "id": 2, "text": "What tiny ritual should we try this month?" }\n  ]\n}\n\n—or—\nOne question per line\nWhat made you smile this week?\nWhat tiny ritual should we try this month?'></textarea>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="startBtn">Load & Start ▶</button>
          <button class="btn secondary" id="sampleBtn" title="Load a small demo list">Load sample</button>
        </div>
        <p class="small subtle">Tips: Paste once and it will be saved to your browser (localStorage). Use <span class="kbd">R</span> to draw again during the game.</p>
      </div>

      <div class="card">
        <h2>Standard formats accepted</h2>
        <p><strong>A) JSON object</strong> with <span class="mono">title</span> and <span class="mono">questions[]</span> (objects require <span class="mono">id</span> + <span class="mono">text</span>):</p>
        <pre class="mono card" style="white-space:pre-wrap; padding:14px; overflow:auto"><code>{
  "title": "Tea & Candles – 20 Questions",
  "questions": [
    { "id": 1, "text": "What tiny moment from our early days still makes you smile?" },
    { "id": 2, "text": "What’s one small ritual we could start this season?" }
  ]
}</code></pre>
        <p><strong>B) Plain text</strong>: one question per line.</p>
        <pre class="mono card" style="white-space:pre-wrap; padding:14px; overflow:auto"><code>What tiny moment from our early days still makes you smile?
What’s one small ritual we could start this season?
If we had a free 24 hours tomorrow, how would you want to spend it?</code></pre>
        <p class="subtle">Your data is stored only in your browser (localStorage) for convenience.</p>
      </div>
    </section>

    <!-- GAME VIEW -->
    <section id="gameView" class="hidden">
      <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:12px">
        <div id="gameTitle" class="pill">Ready</div>
        <div class="row">
          <button class="btn secondary" id="backBtn">⟵ Setup</button>
          <button class="btn" id="drawBtn">Draw Random Question 🎲</button>
        </div>
      </div>

      <div class="stage">
        <div id="questionCard" class="question-card">Click <em>Draw Random Question</em> to begin</div>
      </div>

      <div class="footer">
        <span id="remainingInfo">0 / 0 drawn</span>
        <span class="subtle"> · Press <span class="kbd">R</span> to draw again</span>
      </div>
    </section>
  </div>

  <script>
    const els = {
      setup: document.getElementById('setupView'),
      game: document.getElementById('gameView'),
      input: document.getElementById('inputArea'),
      start: document.getElementById('startBtn'),
      sample: document.getElementById('sampleBtn'),
      back: document.getElementById('backBtn'),
      draw: document.getElementById('drawBtn'),
      card: document.getElementById('questionCard'),
      title: document.getElementById('gameTitle'),
      remaining: document.getElementById('remainingInfo'),
    };

    let deck = [];
    let used = new Set();
    let title = 'Questions';

    // UTIL: Save/Load from localStorage
    const LS_KEY = 'rqpicker:lastListV1';
    function saveToLS(payload){ try { localStorage.setItem(LS_KEY, JSON.stringify(payload)); } catch(e){} }
    function loadFromLS(){ try { return JSON.parse(localStorage.getItem(LS_KEY) || 'null'); } catch(e){ return null } }

    // Parsing input — supports JSON or plain lines
    function parseInput(text){
      text = text.trim();
      if(!text) throw new Error('Empty input');
      // Try JSON first
      try {
        const obj = JSON.parse(text);
        if(Array.isArray(obj)){
          return { title: 'Questions', questions: obj.map((t, i) => ({ id: i+1, text: String(t).trim() })).filter(q => q.text) };
        }
        if(obj && Array.isArray(obj.questions)){
          const qs = obj.questions.map((q, i) => ({ id: Number(q.id ?? (i+1)), text: String(q.text ?? '').trim() })).filter(q => q.text);
          return { title: String(obj.title || 'Questions'), questions: qs };
        }
        // If JSON string
        if(typeof obj === 'string'){
          const lines = obj.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
          return { title: 'Questions', questions: lines.map((t,i)=>({id:i+1,text:t})) };
        }
      } catch(e){ /* fall back to plain text */ }

      // Plain text mode: one question per non-empty line
      const lines = text.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      if(!lines.length) throw new Error('No questions found');
      return { title: 'Questions', questions: lines.map((t,i)=>({id:i+1,text:t})) };
    }

    function startGame(payload){
      deck = payload.questions.slice();
      used = new Set();
      title = payload.title || 'Questions';
      els.title.textContent = `${title} · ${deck.length} total`;
      els.card.innerHTML = 'Click <em>Draw Random Question</em> to begin';
      updateRemaining();
      els.setup.classList.add('hidden');
      els.game.classList.remove('hidden');
    }

    function updateRemaining(){
      els.remaining.textContent = `${used.size} drawn · ${deck.length - used.size} remaining`;
    }

    function drawQuestion(){
      if(used.size >= deck.length){
        flashCard("All questions drawn! Click ⟵ Setup to load a new list.");
        return;
      }
      // Pick a random index not yet used
      let idx;
      do { idx = Math.floor(Math.random() * deck.length); } while(used.has(idx));
      used.add(idx);
      const q = deck[idx];
      flashCard(q.text);
      updateRemaining();
    }

    function flashCard(text){
      els.card.classList.remove('question-card');
      // Force reflow to restart animation
      void els.card.offsetWidth;
      els.card.classList.add('question-card');
      els.card.textContent = text;
    }

    // Sample list for quick try
    const SAMPLE = {
      title: 'Tea & Candles – 20 Questions',
      questions: [
        {id:1,text:'What tiny moment from our early days still makes you smile?'},
        {id:2,text:'If we had a free 24 hours tomorrow, how would you spend it together?'},
        {id:3,text:'What’s one small ritual we could start this season?'},
        {id:4,text:'Which home felt most “us,” and why?'},
        {id:5,text:'What’s something about me you think I underrate in myself?'},
        {id:6,text:'Name a micro‑adventure we could do with our daughter and dog this month.'},
        {id:7,text:'What would 25‑year‑old us find hilarious if we tried it now?'},
        {id:8,text:'What song or movie instantly feels like “us”?'},
        {id:9,text:'What’s a challenge we navigated well as a team?'},
        {id:10,text:'If you could pause time for one day, what would we do?'},
        {id:11,text:'What tiny upgrade to our evenings would you love to try?'},
        {id:12,text:'Name a place within 2 hours we could escape to overnight.'},
        {id:13,text:'What’s one way we’ve influenced each other (for the better)?'},
        {id:14,text:'What part of parenting are we unexpectedly good at together?'},
        {id:15,text:'What do you want to feel more often this season?'},
        {id:16,text:'What hobby could be fun to learn together this winter?'},
        {id:17,text:'What’s one boundary that helps you feel cared for by me?'},
        {id:18,text:'What are you grateful for this week (tiny is fine)?'},
        {id:19,text:'What tradition should we invent for Friday nights?'},
        {id:20,text:'What’s a silly, low‑effort date we could repeat monthly?'}
      ]
    };

    // Wire up events
    els.sample.addEventListener('click', () => {
      els.input.value = JSON.stringify(SAMPLE, null, 2);
      window.scrollTo({top:0, behavior:'smooth'});
    });

    els.start.addEventListener('click', () => {
      try {
        const payload = parseInput(els.input.value);
        if(!payload.questions.length) throw new Error('No questions parsed');
        saveToLS(payload);
        startGame(payload);
      } catch(err){
        alert('Could not load questions.\n' + err.message);
      }
    });

    els.back.addEventListener('click', () => {
      els.game.classList.add('hidden');
      els.setup.classList.remove('hidden');
    });

    els.draw.addEventListener('click', drawQuestion);

    // Keyboard shortcut: R to draw again
    window.addEventListener('keydown', (e) => {
      if(document.getElementById('gameView').classList.contains('hidden')) return;
      if(e.key.toLowerCase() === 'r'){ e.preventDefault(); drawQuestion(); }
    });

    // Auto-load last list if present
    const last = loadFromLS();
    if(last && last.questions && last.questions.length){
      els.input.value = JSON.stringify(last, null, 2);
    }
  </script>
</body>
</html>
