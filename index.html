<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Random Question Picker</title>
  <style>
    :root{
      --bg: #0f172a;       /* slate-900 */
      --panel: #111827;    /* gray-900 */
      --muted: #94a3b8;    /* slate-400 */
      --text: #e5e7eb;     /* gray-200 */
      --accent: #22d3ee;   /* cyan-400 */
      --accent-2: #a78bfa; /* violet-400 */
      --ok: #34d399;       /* emerald-400 */
      --warn: #fb7185;     /* rose-400 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% -10%, rgba(34,211,238,.15), transparent 50%),
                  radial-gradient(1000px 700px at 110% 10%, rgba(167,139,250,.12), transparent 50%),
                  var(--bg);
      color: var(--text);
    }
    a { color: var(--accent) }
    .container { max-width: 980px; margin: 0 auto; padding: 24px; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px; padding: 22px; box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
    }
    h1 { font-size: clamp(28px, 4vw, 40px); margin: 8px 0 6px; letter-spacing: .3px }
    h2 { font-size: clamp(20px, 3vw, 26px); margin: 14px 0 8px }
    p { color: var(--muted); line-height: 1.6 }
    .grid { display: grid; gap: 16px }
    @media(min-width: 900px){ .grid-2 { grid-template-columns: 1.1fr .9fr } }

    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    textarea, input, button { font-family: inherit }
    textarea {
      width: 100%; min-height: 220px; resize: vertical; border-radius: 14px;
      background: #0b1220; color: var(--text); border: 1px solid rgba(255,255,255,.12);
      padding: 14px; line-height: 1.5;
    }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center }
    .btn {
      border: 0; cursor: pointer; padding: 12px 16px; border-radius: 12px; font-weight: 600;
      background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #001018;
      transition: transform .06s ease, filter .2s ease; box-shadow: 0 8px 25px rgba(34,211,238,.2);
    }
    .btn.secondary { background: #0b1220; color: var(--text); border: 1px solid rgba(255,255,255,.12) }
    .btn:active { transform: translateY(1px) }

    .hidden { display: none }

    /* Question card animations */
    .stage { display: grid; place-items: center; min-height: 52vh }
    .question-card {
      max-width: 760px; text-align: center; padding: 26px 26px; border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04);
      backdrop-filter: blur(6px); box-shadow: var(--shadow);
      font-size: clamp(20px, 3.2vw, 28px);
      transform: scale(.98); opacity: 0; animation: pop .45s ease forwards;
    }
    @keyframes pop { from { transform: scale(.92); opacity: 0 } to { transform: scale(1); opacity: 1 } }
    .subtle { color: var(--muted); font-size: 14px; margin-top: 8px }

    .pill { display: inline-flex; gap: 8px; align-items: center; padding: 6px 10px; border-radius: 999px; font-size: 12px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.03) }

    .footer { margin-top: 28px; color: var(--muted); font-size: 13px }
    .small { font-size: 12px }
    .kbd { border: 1px solid rgba(255,255,255,.2); border-bottom-width: 3px; padding: 2px 6px; border-radius: 6px; background: rgba(255,255,255,.06); font-family: ui-monospace, SFMono-Regular, Menlo, monospace }
  </style>
</head>
<body>
  <div class="container">
    <!-- SETUP VIEW -->
    <section id="setupView" class="grid grid-2">
      <div class="card">
        <h1>Random Question Picker</h1>
        <p>Paste a list of questions, then start the game. During the game you can draw a <em>new random question</em> each time without repeats until the list is exhausted.</p>
        <h2>1) Prompt an LLM to create a list</h2>
        <p>Send this prompt to your LLM to generate questions on any topic. The model should respond as <strong>plain text only</strong>, with <strong>one question per line</strong> (no JSON, no markdown).</p>
        <pre class="mono card" style="white-space:pre-wrap; padding:14px; overflow:auto"><code>Generate a list of conversation questions about &lt;YOUR_TOPIC&gt; tailored to &lt;YOUR_CONTEXT&gt;.
Return ONLY plain text with ONE question per line.
Rules:
- Provide 10â€“40 questions.
- No numbering, no bullets, no JSON, no markdown.
- Keep each question on a single line.
- Avoid trailing or leading spaces.</code></pre>

        <h2>2) Paste your list below</h2>
        <p>Paste <strong>one question per line</strong>. Then click <em>Load & Start</em>.</p>
        <textarea id="inputArea" placeholder='What tiny moment made you smile this week?&#10;If you had a free day tomorrow, how would you spend it?&#10;What skill are you learning next and why?&#10;nWhich book or podcast changed how you think recently?&#10;Whatâ€™s a small upgrade to your daily routine youâ€™d try?'></textarea>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="startBtn" aria-label="Load and start the game">Load & Start â–¶</button>
          <button class="btn secondary" id="sampleBtn" title="Load a small demo list">Load sample</button>
        </div>
        <p class="small subtle">Tips: Paste once and it will be saved to your browser (localStorage). Use <span class="kbd">R</span> to draw again during the game.</p>
      </div>

      <div class="card">
        <h2>Accepted format</h2>
        <p><strong>Plain text only</strong>: one question per line.</p>
        <pre class="mono card" style="white-space:pre-wrap; padding:14px; overflow:auto"><code>What tiny moment made you smile this week?
If you had a free day tomorrow, how would you spend it?
What skill are you learning next and why?</code></pre>
        <p class="subtle">Your data is stored only in your browser (localStorage) for convenience.</p>
      </div>
    </section>

    <!-- GAME VIEW -->
    <section id="gameView" class="hidden">
      <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:12px">
        <div id="gameTitle" class="pill">Ready</div>
        <div class="row">
          <button class="btn secondary" id="backBtn">âŸµ Setup</button>
          <button class="btn" id="drawBtn">Draw Random Question ðŸŽ²</button>
        </div>
      </div>

      <div class="stage">
        <div id="questionCard" class="question-card">Click <em>Draw Random Question</em> to begin</div>
      </div>

      <div class="footer">
        <span id="remainingInfo">0 drawn Â· 0 remaining</span>
        <span class="subtle"> Â· Press <span class="kbd">R</span> to draw again</span>
      </div>
    </section>

    <p id="testStatus" class="small subtle" style="margin-top:16px"></p>
  </div>

  <script>
    const els = {
      setup: document.getElementById('setupView'),
      game: document.getElementById('gameView'),
      input: document.getElementById('inputArea'),
      start: document.getElementById('startBtn'),
      sample: document.getElementById('sampleBtn'),
      back: document.getElementById('backBtn'),
      draw: document.getElementById('drawBtn'),
      card: document.getElementById('questionCard'),
      title: document.getElementById('gameTitle'),
      remaining: document.getElementById('remainingInfo'),
      testStatus: document.getElementById('testStatus'),
    };

    let deck = [];
    let used = new Set();
    let title = 'Questions';

    // UTIL: Save/Load from localStorage
    const LS_KEY = 'rqpicker:lastListV1';
    function saveToLS(payload){ try { localStorage.setItem(LS_KEY, JSON.stringify(payload)); } catch(e){} }
    function loadFromLS(){ try { return JSON.parse(localStorage.getItem(LS_KEY) || 'null'); } catch(e){ return null } }

    // Parse plain-text input: one question per line
    function parseInput(text){
      const t = String(text || '').trim();
      if(!t) throw new Error('Empty input');
      const lines = t.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      if(!lines.length) throw new Error('No questions found');
      return { title: 'Questions', questions: lines.map((q,i)=>({ id: i+1, text: q })) };
    }

    function startGame(payload){
      deck = payload.questions.slice();
      used = new Set();
      title = payload.title || 'Questions';
      els.title.textContent = `${title} Â· ${deck.length} total`;
      els.card.innerHTML = 'Click <em>Draw Random Question</em> to begin';
      updateRemaining();
      els.setup.classList.add('hidden');
      els.game.classList.remove('hidden');
    }

    function updateRemaining(){
      els.remaining.textContent = `${used.size} drawn Â· ${deck.length - used.size} remaining`;
    }

    function drawQuestion(){
      if(!deck.length){ flashCard('No questions loaded yet.'); return; }
      if(used.size >= deck.length){
        flashCard('All questions drawn! Click âŸµ Setup to load a new list.');
        return;
      }
      // Pick a random index not yet used
      let idx;
      do { idx = Math.floor(Math.random() * deck.length); } while(used.has(idx));
      used.add(idx);
      const q = deck[idx];
      flashCard(q.text);
      updateRemaining();
    }

    function flashCard(text){
      els.card.classList.remove('question-card');
      // Force reflow to restart animation
      void els.card.offsetWidth;
      els.card.classList.add('question-card');
      els.card.textContent = text;
    }

    // Sample list (non-couple general curiosity)
    const SAMPLE_LINES = [
      'What is a topic you could talk about for hours right now?',
      'Which book, article, or podcast recently changed your mind?',
      'If you could learn one skill in 30 days, what would it be?',
      'Whatâ€™s a problem youâ€™re currently solving and how are you approaching it?',
      'What habit has had the biggest ROI for you this year?',
      'Which place within 2 hours of home would you dayâ€‘trip to and why?',
      'Whatâ€™s a small purchase (â‰¤â‚¬25) that improved your life?',
      'Whatâ€™s an assumption you held that didnâ€™t survive contact with reality?',
      'What does your ideal focused morning look like?',
      'Whatâ€™s a failure that later turned into a lucky break?',
      'Which constraint has made you more creative recently?',
      'What topic would you give a 10â€‘minute lightning talk on?',
      'Whatâ€™s a kindness you noticed this month?',
      'Which tool or app genuinely saves you time?',
      'If you had to remove one recurring task from your week, what would it be?',
      'Whatâ€™s a microâ€‘adventure youâ€™d try before winter?',
      'Which question do you wish people asked you more often?',
      'Whatâ€™s a system you improved lately and how?',
      'Which skill from your childhood would you like to revive?',
      'What are you excited to learn next quarter?'
    ];

    // Wire up events
    els.sample.addEventListener('click', () => {
      els.input.value = SAMPLE_LINES.join('\n');
      window.scrollTo({top:0, behavior:'smooth'});
    });

    els.start.addEventListener('click', () => {
      try {
        const payload = parseInput(els.input.value);
        if(!payload.questions.length) throw new Error('No questions parsed');
        saveToLS({ title: payload.title, questions: payload.questions, raw: els.input.value });
        startGame(payload);
      } catch(err){
        alert('Could not load questions.\n' + err.message);
      }
    });

    els.back.addEventListener('click', () => {
      els.game.classList.add('hidden');
      els.setup.classList.remove('hidden');
    });

    els.draw.addEventListener('click', drawQuestion);

    // Keyboard shortcut: R to draw again
    window.addEventListener('keydown', (e) => {
      if(document.getElementById('gameView').classList.contains('hidden')) return;
      if(e.key.toLowerCase() === 'r'){ e.preventDefault(); drawQuestion(); }
    });

    // Auto-load last list if present
    (function preload(){
      const last = loadFromLS();
      if(last && last.raw){ els.input.value = last.raw; }
    })();

    // ----------------------
    // Minimal test harness
    // ----------------------
    function runTests(){
      const results = [];
      function ok(name, cond){ results.push({name, pass: !!cond}); if(!cond) console.error('Test failed:', name); }

      // parseInput basic
      const p1 = parseInput('A\nB');
      ok('parseInput two lines', p1.questions.length === 2 && p1.questions[0].text==='A' && p1.questions[1].text==='B');

      // Windows newlines
      const p2 = parseInput('A\r\nB\r\nC');
      ok('parseInput CRLF', p2.questions.length === 3);

      // Trimming & empty lines
      const p3 = parseInput('  A  \n\n  B  ');
      ok('parseInput trims & ignores blanks', p3.questions.length === 2 && p3.questions[0].text==='A' && p3.questions[1].text==='B');

      // Error on empty
      let threw = false; try{ parseInput('   '); } catch(e){ threw = true; }
      ok('parseInput throws on empty', threw);

      // Deck no repeat simulation (deterministic via indexing rather than randomness)
      const d = ['q1','q2','q3'];
      const usedSim = new Set();
      for(let i=0;i<d.length;i++){ usedSim.add(i); }
      ok('used set size equals deck length after fill', usedSim.size === d.length);

      const passCount = results.filter(r=>r.pass).length;
      const allPass = passCount === results.length;
      els.testStatus.textContent = allPass ? `Tests passed: ${passCount}/${results.length} âœ“` : `Tests failed: ${results.length - passCount}/${results.length} âœ—`;
      return allPass;
    }

    // Run tests silently on load (status shown at bottom)
    runTests();
  </script>
</body>
</html>
